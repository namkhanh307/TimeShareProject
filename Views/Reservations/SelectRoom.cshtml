@model TimeShareProject.Models.Property

@{
    var layout = "_Layout.cshtml";

    if (User.Identity.IsAuthenticated)
    {
        var userRole = User.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Role)?.Value;

        switch (userRole)
        {
            case "1": // Admin
                layout = "_AdminLayout.cshtml";
                break;
            case "2": // Staff
                layout = "_AdminLayout.cshtml";
                break;
            case "3": // User
                layout = "_Layout.cshtml";
                break;
            default:
                break;
        }
    }

    Layout = $"~/Views/Shared/{layout}";
}

<div class="container">
    <div>
        <h3>Booking information</h3>
        <p>Property code: @ViewBag.Property.Name</p>
        <p>Block: @ViewBag.Block.Id (from @ViewBag.Block.StartDay/@ViewBag.Block.EndMonth to @ViewBag.Block.EndDay/@ViewBag.Block.EndMonth) every year</p>
        <p>Beds: @ViewBag.Property.Beds</p>
        <p>Book timeshare in 10 years from now</p>
        @{
            // Convert ViewBag.Property.UnitPrice to float
            float unitPrice = 0; // Default value or handle conversion failure
            if (ViewBag.Property.UnitPrice != null)
            {
                float.TryParse(ViewBag.Property.UnitPrice.ToString(), out unitPrice);
                float totalPrice = @Common.Calculate(unitPrice);
                string formattedPrice = totalPrice.ToString("N0") + " VND"; // "N0" format specifier adds thousand separators
                <p>Price: @formattedPrice</p>
            }
        }
        <p>
            Account Name: NGUYEN VIET NAM KHANH
        </p>
        <p>
            Account No: 0919385156
        </p>
        <p>
            Bank Name: MB Bank
        </p>
        <p>Reservation fee will be 500,000 VND! Please submit your transaction code of your banking below!</p>
    </div>
    <div>
        <p>Please review the selected block and property details above. If everything looks correct, you can confirm your reservation.</p>
        @{
            if (@Common.CountReservations(@ViewBag.Property.Id, @ViewBag.Block.Id) > 0)
            {
                <p class="text-danger">This property has been reserved by @Common.CountReservations(@ViewBag.Property.Id, @ViewBag.Block.Id) people!! Do you really want to reserve?</p>
            }
        }

        <form asp-action="ConfirmReservation" asp-controller="Reservations" method="post">
            <input type="hidden" name="blockSelect" value="@ViewBag.Block.Id" />
            <input type="hidden" name="propertyId" value="@ViewBag.Property.Id" />
            <input type="hidden" name="saleStatus" value="@ViewBag.SaleStatus" />
            @{
                if(ViewBag.SaleStatus == "Reserve")
                {
                    <label>Transaction Code</label>
                    <input type="text" name="transactionCode" required/>
                }
            }
            <button type="submit" class="btn btn-primary">Confirm Reservation</button>
        </form>
        <form asp-action="FilterProperties" asp-controller="Properties">
            <input type="hidden" name="projectId" value="@ViewBag.ProjectId" />
            <input type="hidden" name="saleStatus" value="@ViewBag.SaleStatus" />
            <input type="hidden" name="bedSelect" value="@ViewBag.BedSelect" />
            <input type="hidden" name="blockSelect" value="@ViewBag.Block.Id" />

            <button type="submit" class="btn btn-primary">Back</button>
        </form>
    </div>
</div>
@* 
<div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="false">
    <div class="toast-header">
        <strong class="me-auto">Reservation Confirmation</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body row justify-content-center">
        <div class="col-12 text-center">
            Reservation confirmed! Added to cart successfully.
        </div>
        <form id="confirmReservationForm" asp-action="ConfirmReservation" asp-controller="Reservations" method="post">
            <input type="hidden" name="saleStatus" value="@ViewBag.SaleStatus" />
            <input type="hidden" name="blockSelect" value="@ViewBag.Block.Id" />
            <input type="hidden" name="propertyId" value="@ViewBag.Property.Id" />
            @{
                if (ViewBag.SaleStatus == "Reserve")
                {
                    <label>Transaction Code</label>
                    <input type="text" name="transactionCode" required />
                }
            }
            <div class="col-12 text-center mt-3">
                <button type="button" class="btn btn-primary" id="confirmToast">Confirm</button>
            </div>

        </form>
       
    </div>
</div>

<script>
    // Show the toast when the document is ready
    document.addEventListener('DOMContentLoaded', function () {
        var toastEl = document.querySelector('.toast');
        var toast = new bootstrap.Toast(toastEl);

        var confirmReservationForm = document.getElementById('confirmReservationForm');
        if (confirmReservationForm) {
            confirmReservationForm.addEventListener('submit', function (event) {
                event.preventDefault();
                toast.show();
            });
        }
    });
</script> *@
